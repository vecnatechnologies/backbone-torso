!function(e,t){"function"==typeof define&&define.amd?define(["underscore","backbone"],t):"object"==typeof exports?module.exports=t(require("underscore"),require("backbone")):(e.Torso=e.Torso||{},e.Torso.Events=t(e._,e.Backbone))}(this,function(e,t){"use strict";var i=e.extend({},t.Events);return i}),function(e,t){"function"==typeof define&&define.amd?define(["backbone"],t):"object"==typeof exports?module.exports=t(require("backbone")):(e.Torso=e.Torso||{},e.Torso.Router=t(e.Backbone))}(this,function(e){"use strict";return e.Router.extend({})}),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():(e.Torso=e.Torso||{},e.Torso.Mixins=e.Torso.Mixins||{},e.Torso.Mixins.cellPersistenceRemovalMixin=t())}(this,function(){"use strict";return{isModelCompatible:!1,save:function(){if(!this.isModelCompatible)throw"Cell does not have save"},fetch:function(){if(!this.isModelCompatible)throw"Cell does not have fetch"},sync:function(){if(!this.isModelCompatible)throw"Cell does not have sync"},url:function(){if(!this.isModelCompatible)throw"Cell does not have url"}}}),function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):(e.Torso=e.Torso||{},e.Torso.Mixins=e.Torso.Mixins||{},e.Torso.Mixins.collectionLoading=t(e.jQuery||e.Zepto||e.ender||e.$))}(this,function(e){var t=function(t){return{constructor:function(i){t.call(this,i),this.loadedOnceDeferred=new e.Deferred,this.loadedOnce=!1,this.loading=!1},hasLoadedOnce:function(){return this.loadedOnce},isLoading:function(){return this.loading},getLoadedOncePromise:function(){return this.loadedOnceDeferred.promise()},fetch:function(e){return this.__loadWrapper(t.prototype.fetch,e)},__loadWrapper:function(t,i){var n=this;return this.loading=!0,this.trigger("load-begin"),e.when(t.call(n,i)).done(function(e,t,i){n.trigger("load-complete",{success:!0,data:e,textStatus:t,jqXHR:i})}).fail(function(e,t,i){n.trigger("load-complete",{success:!1,jqXHR:e,textStatus:t,errorThrown:i})}).always(function(){n.loadedOnce||(n.loadedOnce=!0,n.loadedOnceDeferred.resolve()),n.loading=!1})}}};return t}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","jquery"],t):"object"==typeof exports?module.exports=t(require("underscore"),require("jquery")):(e.Torso=e.Torso||{},e.Torso.Mixins=e.Torso.Mixins||{},e.Torso.Mixins.collectionRegistration=t(e._,e.jQuery||e.Zepto||e.ender||e.$))}(this,function(e,t){var i=function(i){var n,s;return s=function(i,n){return i.constructor.extend(function(i,n,s){var r={getTrackedIds:function(){return this.trackedIds},fetch:function(){var e=this;return this.__loadWrapper(function(){return e.trackedIds&&e.trackedIds.length?n.fetchByIds({idsToFetch:e.trackedIds,setOptions:{remove:!1}}):t.Deferred().resolve().promise()})},trackIds:function(t){this.remove(e.difference(this.trackedIds,t)),n.registerIds(t,s),this.trackedIds=t},addModelAndTrack:function(e){this.add(e),n.add(e),this.trackNewId(e.id)},trackNewId:function(e){this.trackIds(this.getTrackedIds().concat(e))},fetchByIds:function(e){return this.trackIds(e),this.fetch()},fetchSubsetOfTrackedIds:function(i){var s=e.intersection(i,this.getTrackedIds());return this.__loadWrapper(function(){return s&&s.length?n.fetchByIds({idsToFetch:s,setOptions:{remove:!1}}):t.Deferred().resolve().promise()})},pull:function(){var i=e.difference(this.getTrackedIds(),e.pluck(n.models,"id"));return this.__loadWrapper(function(){return i&&i.length?n.fetchByIds({idsToFetch:i,setOptions:{remove:!1}}):t.Deferred().resolve().promise()})},pullByIds:function(e){return this.trackIds(e),this.pull()},requesterDispose:function(){n.removeRequester(s)}};return r}(i.constructor.__super__,i,n))},n=function(n){var r=function(t,i){n.requestMap[t]={array:i,dict:e.object(e.map(i,function(e){return[e,e]}))}};n.getRequesterIds=function(e){return this.requestMap[e]&&this.requestMap[e].array},n.getRequesterIdsAsDictionary=function(e){return this.requestMap[e]&&this.requestMap[e].dict},n.removeRequester=function(e){delete this.requestMap[e],delete this.knownPrivateCollections[e]},n.getRequesters=function(){return e.keys(this.requestMap)},n.getAllRequestedIds=function(){return this.collectionTrackedIds},n.createPrivateCollection=function(e,t){t=t||{},t.isRequester=!0,t.parentInstance=n;var i=s(n,e);return this.knownPrivateCollections[e]=new i(null,t),this.knownPrivateCollections[e]},n.registerIds=function(t,i){var s,o,a,d,c,u,l,h,f=[],p={},m=[];for(r(i,t),u=n.getRequesters(),l=u.length,o=0;o<t.length;o++)a=n.get(t[o]),a&&f.push(a);for(h=n.knownPrivateCollections[i],h.set(f,{remove:!1}),d=0;l>d;d++)if(c=this.getRequesterIds(u[d]),!e.isUndefined(c))for(s=0;s<c.length;s++)p[c[s]]=!0;for(s in p)m.push(s);this.collectionTrackedIds=m,this.polledFetch=function(){n.fetchByIds({setOptions:{remove:!0}})}},n.fetch=function(t){return t=t||{},this.fetchUsingTrackedIds?this.fetchByIds({setOptions:e.extend({remove:!0},t)}):i.prototype.fetch.apply(this,t)},n.fetchByIds=function(i){return i=i||{},this.__loadWrapper(function(i){var s,r;return s=i.idsToFetch||n.collectionTrackedIds,r=n.lazyFetch?e.difference(s,this.models.pluck("id")):s,t.ajax({type:n.fetchHttpAction,url:e.result(n,"url")+n.getByIdsUrl,contentType:"application/json; charset=utf-8",data:JSON.stringify(r)}).done(function(e){var t,r,o,a,d,c,u,l,h=s.length,f=i.setOptions;for(n.set(n.parse(e),f),u=n.getRequesters(),c=u.length,r=0;c>r;r++){for(o=n.getRequesterIdsAsDictionary(u[r]),a=[],t=0;h>t;t++)o[s[t]]&&(l=n.get(s[t]),l&&a.push(l));d=n.knownPrivateCollections[u[r]],d.set(a,{remove:!1})}})},i)},n.setLazyFetch=function(e){this.lazyFetch=e},n.isLazyFetch=function(){return this.lazyFetch}},{constructor:function(e,t){t=t||{},i.call(this,e,t),this.isRequester=t.isRequester,this.parentInstance=t.parentInstance,this.isRequester?(this.trackedIds=[],this.listenTo(this.parentInstance,"load-begin",function(){this.trigger("cache-load-begin")}),this.listenTo(this.parentInstance,"load-complete",function(){this.trigger("cache-load-complete")})):(this.requestMap={},this.collectionTrackedIds=[],this.knownPrivateCollections={},this.getByIdsUrl=t.getByIdsUrl||"/ids",this.fetchHttpAction=t.fetchHttpAction||"POST",this.lazyFetch=t.lazyFetch||!1,this.fetchUsingTrackedIds=t.fetchUsingTrackedIds!==!1,n(this))},dispose:function(){this.unbind(),this.off(),this.stopListening(),this.stopPolling(),this.isRequester&&this.requesterDispose()},filterDefault:function(){return this.constructor(this)}}};return i}),function(e,t){"function"==typeof define&&define.amd?define(["backbone","jquery"],t):"object"==typeof exports?module.exports=t(require("backbone"),require("jquery")):t(e.Backbone,e.$)}(this,function(e,t){"use strict";return e.$=t,!0}),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():(e.Torso=e.Torso||{},e.Torso.Utils=e.Torso.Utils||{},e.Torso.Utils.handlebarsUtils=t())}(this,function(){"use strict";return function(e){var t="feedback",i="model";e.registerHelper("labelFor",function(t,i){return e.helpers.formAttr(t,"for",i)}),e.registerHelper("bindModel",function(n,s){return e.helpers.formAttr(n,i+", "+t+", name, id",s)}),e.registerHelper("feedback",function(i,n){return e.helpers.formAttr(i,t,n)}),e.registerHelper("formAttr",function(n,s,r){var o,a,d=r.hash?r.hash.value:void 0,c=e.helpers.injectFieldIndices(n,r.hash),u="";for(s=s.split(","),o=0;o<s.length;o++)a=s[o].trim(),a===t?u+='data-feedback="'+c+'" ':a===i?u+='data-model="'+c+'" ':"name"===a?u+='name="'+e.helpers.dasherize(c)+'" ':"id"===a?(u+='id="'+e.helpers.dasherize(c),void 0!==d&&(u+="-"+d),u+='" '):"for"===a&&(u+='for="'+e.helpers.dasherize(c),void 0!==d&&(u+="-"+d),u+='" ');return void 0!==d&&(u+='value="'+d+'"'),new e.SafeString(u)}),e.registerHelper("dasherize",function(e){var t,i,n;return t=e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}),i=t.replace(/\./g,function(){return"_"}),n=i.replace(/\[[0-9]+\]/g,function(e){return"-"+e.substring(1,e.length-1)})}),e.registerHelper("injectFieldIndices",function(e,t){return t?e.replace(/\[.+?\]/g,function(e){var i=t[e.substring(1,e.length-1)];return"["+(void 0===i?"":i)+"]"}):e})}}),function(e,t){"function"==typeof define&&define.amd?define(["backbone"],t):"object"==typeof exports?module.exports=t(require("backbone")):(e.Torso=e.Torso||{},e.Torso.history=t(e.Backbone))}(this,function(e){"use strict";return e.history}),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():(e.Torso=e.Torso||{},e.Torso.Mixins=e.Torso.Mixins||{},e.Torso.Mixins.polling=t())}(this,function(){var e={pollTimeoutId:void 0,__pollStarted:!1,__pollInterval:5e3,isPolling:function(){return this.__pollStarted},startPolling:function(e){var t=this;e&&(this.__pollInterval=e),this.__pollStarted||(this.__pollStarted=!0,this.__poll(),this.pollTimeoutId=window.setInterval(function(){t.__poll()},this.__pollInterval))},stopPolling:function(){window.clearInterval(this.pollTimeoutId),this.__pollStarted=!1},polledFetch:function(){this.fetch()},__poll:function(){this.polledFetch()}};return e}),function(e,t){"function"==typeof define&&define.amd?define(["backbone","backbone.stickit"],t):"object"==typeof exports?(require("backbone.stickit"),t(require("backbone"))):t(e.Backbone)}(this,function(e){"use strict";e.Stickit.addHandler({selector:'input[type="radio"]',events:["change"],update:function(e,t){e.prop("checked",!1),e.filter('[value="'+t+'"]').prop("checked",!0)},getVal:function(e){return e.filter(":checked").val()}})}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","jquery"],t):"object"==typeof exports?module.exports=t(require("underscore"),require("jquery")):(e.Torso=e.Torso||{},e.Torso.Utils=e.Torso.Utils||{},e.Torso.Utils.templateRenderer=t(e._,e.jQuery||e.Zepto||e.ender||e.$))}(this,function(e,t){"use strict";function i(e,i,n){var s,o=i.nodeType,a=e.nodeType;o!==a?t(e).replaceWith(i):(s=r[o]||r["default"])(e,i,n)}function n(n,s,r){var o,a,d,c,u,l=t(n),h=t(s),f=0;if(a=e.some(r,function(e){return l.is(e)}),!a){if(s.tagName!==n.tagName)return void l.replaceWith(s);for(u=n.attributes;f<u.length;)o=u[f].name,s.getAttribute(o)?f++:n.removeAttribute(o);if(e.each(s.attributes,function(e){n.setAttribute(e.name,e.value)}),l.html()!==h.html())return c=h.contents(),d=l.contents(),c.length!==d.length?void l.html(h.html()):void d.each(function(e,t){i(t,c.get(e),r)})}}function s(e,i){var n=i.nodeValue!==e.nodeValue;n&&t(e).replaceWith(i)}var r={1:n,3:s,4:s,8:s,"default":function(e,i){t(e).replaceWith(i)}},o={render:function(e,i,n,s){var r,o=i(n),a=e.get(0);s=s||{},s.force?e.html(o):(r=this.copyTopElement(a),t(r).html(o),this.hotswapKeepCaret(a,r,s.ignoreElements))},hotswapKeepCaret:function(e,t,i){var n,s=document.activeElement;s&&this.supportsSelection(s)&&(n=this.getCaretPosition(s)),this.hotswap(e,t,i),s&&this.supportsSelection(s)&&this.setCaretPosition(s,n)},hotswap:i,copyTopElement:function(t){var i=document.createElement(t.tagName);return e.each(t.attributes,function(e){i.setAttribute(e.name,e.value)}),i},supportsSelection:function(e){return/text|password|search|tel|url/.test(e.type)},getCaretPosition:function(e){var t,i=0;return document.selection?(e.focus(),t=document.selection.createRange(),t.moveStart("character",-e.value.length),i=t.text.length):(e.selectionStart||0===e.selectionStart)&&(i=e.selectionStart),i},setCaretPosition:function(e,t){var i;e&&(e.createTextRange?(i=e.createTextRange(),i.move("character",t),i.select()):e.selectionStart||0===e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus())}};return o}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","backbone","./cellPersistenceRemovalMixin"],t):"object"==typeof exports?module.exports=t(require("underscore"),require("backbone"),require("./cellPersistenceRemovalMixin")):(e.Torso=e.Torso||{},e.Torso.Cell=t(e._,e.Backbone,e.Torso.Mixins.cellPersistenceRemovalMixin))}(this,function(e,t,i){"use strict";var n=t.Model.extend({});return e.extend(n.prototype,i),n}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","backbone","./pollingMixin","./collectionRegistrationMixin","./collectionLoadingMixin"],t):"object"==typeof exports?module.exports=t(require("underscore"),require("backbone"),require("./pollingMixin"),require("./collectionRegistrationMixin"),require("./collectionLoadingMixin")):(e.Torso=e.Torso||{},e.Torso.Collection=t(e._,e.Backbone,e.Torso.Mixins.polling,e.Torso.Mixins.collectionRegistration,e.Torso.Mixins.collectionLoading))}(this,function(e,t,i,n,s){"use strict";var r=t.Collection.extend({});return e.extend(r.prototype,i),r=r.extend(s(r)),r=r.extend(n(r))}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","backbone","./pollingMixin"],t):"object"==typeof exports?module.exports=t(require("underscore"),require("backbone"),require("./pollingMixin")):(e.Torso=e.Torso||{},e.Torso.Model=t(e._,e.Backbone,e.Torso.Mixins.polling))}(this,function(e,t,i){"use strict";var n=t.Model.extend({});return e.extend(n.prototype,i),n}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","backbone","./pollingMixin","backbone-nested"],t):"object"==typeof exports?(require("backbone-nested"),module.exports=t(require("underscore"),require("backbone"),require("./pollingMixin"))):(e.Torso=e.Torso||{},e.Torso.NestedModel=t(e._,e.Backbone,e.Torso.Mixins.polling))}(this,function(e,t,i){"use strict";var n=t.NestedModel.extend({});return e.extend(n.prototype,i),n}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","backbone","./cellPersistenceRemovalMixin","backbone-nested"],t):"object"==typeof exports?(require("backbone-nested"),module.exports=t(require("underscore"),require("backbone"),require("./cellPersistenceRemovalMixin"))):(e.Torso=e.Torso||{},e.Torso.NestedCell=t(e._,e.Backbone,e.Torso.Mixins.cellPersistenceRemovalMixin))}(this,function(e,t,i){"use strict";var n=t.NestedModel.extend({});return e.extend(n.prototype,i),n}),function(e,t){"function"==typeof define&&define.amd?define(["./Cell"],t):"object"==typeof exports?module.exports=t(require("./Cell")):(e.Torso=e.Torso||{},e.Torso.ServiceCell=t(e.Torso.Cell))}(this,function(e){"use strict";var t=e.extend({});return t}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","jquery","backbone","./templateRenderer","./Cell","./NestedCell"],t):"object"==typeof exports?module.exports=t(require("underscore"),require("jquery"),require("backbone"),require("./templateRenderer"),require("./Cell"),require("./NestedCell")):(e.Torso=e.Torso||{},e.Torso.View=t(e._,e.$,e.Backbone,e.Torso.Utils.templateRenderer,e.Torso.Cell,e.Torso.NestedCell))}(this,function(e,t,i,n,s,r){"use strict";var o=i.View.extend({viewState:null,template:null,feedback:null,feedbackCell:null,__childViews:null,__sharedViews:null,__isActive:!1,__isAttachedToParent:!1,__isDisposed:!1,__attachedCallbackInvoked:!1,__feedbackEvents:null,constructor:function(e){e=e||{},this.viewState=new r,this.feedbackCell=new s,this.__childViews={},this.__sharedViews={},this.__injectionSiteMap={},this.__feedbackEvents=[],i.View.apply(this,arguments),e.noActivate||this.activate()},prepare:function(){return this.model?{model:this.model.toJSON(),view:this.viewState.toJSON()}:{view:this.viewState.toJSON()}},render:function(){this.trigger("render-begin"),this.prerender(),this.trigger("render-before-dom-replacement"),this.template&&(this.__updateInjectionSiteMap(),this.detachTrackedViews(),e.isString(this.template)?this.$el.html(this.template):this.templateRender(this.$el,this.template,this.prepare())),this.delegateEvents(),this.trigger("render-after-dom-replacement"),this.attachTrackedViews(),this.__injectionSiteMap={},this.postrender(),this.trigger("render-complete")},get:function(){return this.viewState.get.apply(this.viewState,arguments)},set:function(){return this.viewState.set.apply(this.viewState,arguments)},templateRender:function(e,t,i,s){n.render(e,t,i,s)},delegateEvents:function(){i.View.prototype.delegateEvents.call(this),this.__generateFeedbackBindings(),this.__generateFeedbackCellCallbacks(),e.each(this.getTrackedViews(),function(e){e.isAttachedToParent()&&e.delegateEvents()})},undelegateEvents:function(){i.View.prototype.undelegateEvents.call(this),e.each(this.getTrackedViews(),function(e){e.undelegateEvents()})},injectView:function(e,i,n){if(n=n||{},n.useTransition)return this.transitionNewViewIntoSite(e,i,n);var s=this.$("[inject="+e+"]");return this.attachView(s,i,n),t.Deferred().resolve().promise()},transitionNewViewIntoSite:function(i,n,s){var r,o,a,d,c=t.Deferred();return s=s||{},r=s.previousView,r||(r=this.__getLastTrackedViewAtInjectionSite(i)),e.defaults(s,{parentView:this,newView:n,previousView:r}),s.useTransition=!1,r==n?this.injectView(i,n,s):r?(this.injectView(i,r,s),s.cachedInjectionSite=r.injectionSite,a=s.newInjectionSite=t('<div inject="'+i+'">'),s.addBefore?r.$el.before(a):r.$el.after(a),r.injectionSite=void 0,r.transitionOut(c.resolve,s),d=this.transitionInView(a,n,s),t.when(c.promise(),d)):(o=this.$("[inject="+i+"]"),this.transitionInView(o,n,s))},transitionInView:function(i,n,s){var r=t.Deferred(),o=this;return s=s||{},e.defaults(s,{parentView:this,newView:n}),n.transitionIn(function(){o.attachView(i,n,s)},r.resolve,s),r.promise()},detach:function(){this.isAttachedToParent()&&(this.injectionSite?(this.$el.replaceWith(this.injectionSite),this.injectionSite=void 0):this.$el.detach(),this.invokeDetached(),this.undelegateEvents(),this.__isAttachedToParent=!1)},attach:function(e,t){t=t||{};var i=t.replaceMethod,n=t.discardInjectionSite;this.isAttachedToParent()||(this.render(),this.injectionSite=i?i(this.$el):e.replaceWith(this.$el),n&&(this.injectionSite=void 0),this.__cleanupAfterReplacingInjectionSite())},deactivate:function(){this.deactivateTrackedViews({shared:!1}),this.deactivateTrackedViews({shared:!0}),this.isActive()&&(this._deactivate(),this.__isActive=!1)},activate:function(){this.activateTrackedViews({shared:!1}),this.activateTrackedViews({shared:!0}),this.isActive()||(this._activate(),this.__isActive=!0)},dispose:function(){this._dispose(),this.detach(),this.deactivate(),this.disposeChildViews(),this.remove(),this.off(),this.stopListening(),this.viewState&&(this.viewState.off(),this.viewState.stopListening()),delete this.$el,delete this.el,this.__isDisposed=!0},_dispose:e.noop,_deactivate:e.noop,_activate:e.noop,_attached:e.noop,_detached:e.noop,prerender:e.noop,attachTrackedViews:e.noop,postrender:e.noop,transitionOut:function(e,t){this.detach(),e()},transitionIn:function(e,t,i){e(),t()},attachView:function(e,t,i){i=i||{},t.detach(),this.registerTrackedView(t,i),t.attach(e,i),i.noActivate||t.activate()},hasTrackedViews:function(t){var i=this.getTrackedViews(t);return!e.isEmpty(i)},getTrackedViews:function(t){return t=t||{},t.shared||t.child?e.values(this.__getTrackedViewsHash(t)):e.values(this.__sharedViews).concat(e.values(this.__childViews))},getTrackedView:function(e){var t=this.__childViews[e],i=this.__sharedViews[e];return t||i},disposeChildViews:function(){e.each(this.__childViews,function(e){e.dispose()})},deactivateTrackedViews:function(t){var i=this.getTrackedViews(t);e.each(i,function(e){e.deactivate()})},detachTrackedViews:function(t){var i=this.getTrackedViews(t);e.each(i,function(e){e.detach()})},activateTrackedViews:function(t){var i=this.getTrackedViews(t);e.each(i,function(e){e.activate()})},registerTrackedView:function(e,t){t=t||{},t.child=t.shared?!1:!0;var i=this.__getTrackedViewsHash(t);return i[e.cid]=e,e},unregisterTrackedView:function(e){return delete this.__childViews[e.cid],delete this.__sharedViews[e.cid],e},unregisterTrackedViews:function(t){var i=this.getTrackedViews(t);e.each(i,function(e){this.unregisterTrackedView(e,t)},this)},isAttachedToParent:function(){return this.__isAttachedToParent},isAttached:function(){return t.contains(document,this.$el[0])},isActive:function(){return this.__isActive},isDisposed:function(){return this.__isDisposed},invokeFeedback:function(t,i,n){var s,r=e.find(this.feedback,function(i){var n=i.to;return e.isArray(n)?e.contains(n,t):t===n}),o=t;r&&(n&&(o=this.__substituteIndicesUsingMap(t,n)),s=r.then.call(this,i,n),this.__processFeedbackThenResult(s,o))},invokeAttached:function(){this.__attachedCallbackInvoked||(this._attached(),this.__attachedCallbackInvoked=!0,e.each(this.getTrackedViews(),function(e){e.isAttachedToParent()&&e.invokeAttached()}))},invokeDetached:function(){this.__attachedCallbackInvoked&&(this._detached(),this.__attachedCallbackInvoked=!1),e.each(this.getTrackedViews(),function(e){e.isAttachedToParent()&&e.invokeDetached()})},__getTrackedViewsHash:function(e){return e=e||{},e.shared?this.__sharedViews:this.__childViews},__updateInjectionSiteMap:function(){var t=this;this.__injectionSiteMap={},e.each(this.getTrackedViews(),function(e){e.isAttachedToParent()&&e.injectionSite&&(t.__injectionSiteMap[e.injectionSite.attr("inject")]=e)})},__getLastTrackedViewAtInjectionSite:function(t){var i=this.__injectionSiteMap[t];if(i)i=e.contains(this.getTrackedViews(),i)?i:void 0;else{var n=this.getTrackedViews().filter(function(i){return i.injectionSite&&i.injectionSite.attr("inject")==t&&(!excludingViews||!e.contains(excludingViews,i))});i=e.first(n)}return i},__cleanupAfterReplacingInjectionSite:function(){this.isAttachedToParent()||(this.delegateEvents(),!this.__attachedCallbackInvoked&&this.isAttached()&&this.invokeAttached(),this.__isAttachedToParent=!0)},__generateFeedbackCellCallbacks:function(){var i=this;i.feedbackCell.off(),e.each(this.$("[data-feedback]"),function(n){var s=t(n).data("feedback");i.feedbackCell.on("change:"+s,function(t){return function(){var n,s=i.feedbackCell.get(t);s&&(n=i.$el.find('[data-feedback="'+t+'"]'),e.each(s,function(t,s){var r;r="_"===e.first(s)?i[s.slice(1)]:n[s],e.isArray(t)?r.apply(n,t):void 0!==t&&r.call(n,t)}))}}(s))}),e.each(i.feedbackCell.attributes,function(e,t){i.feedbackCell.trigger("change:"+t)})},__processFeedbackThenResult:function(e,i){var n=t.extend({},e);this.feedbackCell.set(i,n,{silent:!0}),this.feedbackCell.trigger("change:"+i)},__generateFeedbackBindings:function(){var i,n=this;for(i=0;i<this.__feedbackEvents.length;i++)this.off(null,this.__feedbackEvents[i]);this.__feedbackEvents=[],e.each(this.feedback,function(i){var s=[i.to];e.isArray(i.to)&&(s=i.to),e.each(s,function(s){var r=n.__getFeedbackDestinations(s),o=n.__getAllIndexTokens(s);e.each(r,function(s){var r,a,d,c,u,l,h,f;s=t(s),r=s.data("feedback"),a=n.__getAllIndexTokens(r),d={},e.each(o,function(e,t){d[e]=a[t]}),c=i.then,e.isString(c)?c=n[c]:e.isArray(c)&&(u=c.slice(),l=u[0],u.shift(),c=n[l].apply(n,u)),f={feedbackCellField:r,fn:c,indices:d},h=n.__generateWhenEvents(i.when,d),e.each(h,function(t){var i,s,r=function(e){var t,i,s;t=[e],s={},t.push(f.indices),i=f.fn.apply(n,t),n.__processFeedbackThenResult(i,f.feedbackCellField)};s=/^(\S+)\s*(.*)$/,i=t.match(s),n.$el.on(i[1]+".delegateEvents"+n.cid,i[2],e.bind(r,n))}),e.each(i.when.on,function(e){var t=function(){var t,i=[{args:arguments,type:e}];i.push(f.indices),t=f.fn.apply(n,i),n.__processFeedbackThenResult(t,f.feedbackCellField)};n.on(e,t,n),n.__feedbackEvents.push(t)})})})})},__getFeedbackDestinations:function(e){var i=this,n=this.__stripAllAttribute(e),s=e,r=e.indexOf("[");return r>0&&(s=e.substring(0,r)),this.$('[data-feedback^="'+s+'"]').filter(function(){return i.__stripAllAttribute(t(this).data("feedback"))===n})},__generateWhenEvents:function(t,i){var n=this,s=[];return e.each(t,function(t,r){var o,a=[r],d="@"===r.charAt(0);"on"!==r&&(d&&(r=r.substring(1),o=n.__substituteIndicesUsingMap(r,i),a=e.flatten(n.__generateSubAttributes(o,n.model))),e.each(a,function(i){e.each(t,function(e){var t=e+" "+i;d&&(t=e+' [data-model="'+i+'"]'),s.push(t)})}))}),s},__getAllIndexTokens:function(t){return e.reduce(t.match(/\[.+?\]/g),function(e,t){var i=t.substring(1,t.length-1);return isNaN(i)?e.push(i):e.push(parseInt(i,10)),e},[])},__stripAllAttribute:function(e){return e=e.replace(/\[.+?\]/g,function(){return"[]"})},__substituteIndicesUsingMap:function(e,t){var i;return e.replace(/\[.?\]/g,function(e){return e.match(/\[\d+\]/g)||e.match(/\[\]/g)?e:(i=t[e.substring(1,e.length-1)],"["+(void 0===i?"":i)+"]")})},__generateSubAttributes:function(e,t){var i,n,s,r,o,a=e.indexOf("[]");if(-1===a)return[e];if(n=e.substring(0,a),s=e.substring(a+2),r=[],o=t.get(n),!o)return[e];for(i=0;i<o.length;i++)r.push(this.__generateSubAttributes(n+"["+i+"]"+s,t));return r}});return o}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","./NestedModel"],t):"object"==typeof exports?module.exports=t(require("underscore"),require("./NestedModel")):(e.Torso=e.Torso||{},e.Torso.Mixins=e.Torso.Mixins||{},e.Torso.validation=t(e._,e.Torso.NestedModel),e.Torso.Mixins.validation=e.Torso.validation.mixin)}(this,function(e,t){"use strict";var i={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",messageFormatter:"none",valid:Function.prototype,invalid:Function.prototype},n={formatLabel:function(e,t){return c[i.labelFormatter](e,t)},format:function(){return u[i.messageFormatter].apply(u,arguments)}},s=function(t,i,n){return i=i||{},n=n||"",e.each(t,function(e,r){t.hasOwnProperty(r)&&(e&&"object"==typeof e&&e.constructor===Object&&s(e,i,n+r+"."),i[n+r]=e)}),i},r=function(){var r=function(t,i){return i=i||e.keys(e.result(t,"validation")||{}),e.reduce(i,function(e,t){return e[t]=void 0,e},{})},a=function(t,i){var n=t.attributes;return e.isFunction(n)?n=n(i):e.isString(n)&&e.isFunction(l[n])&&(n=l[n](i)),e.isArray(n)?n:void 0},d=function(t,i){var n=t.validation?e.result(t,"validation")[i]||{}:{};return(e.isFunction(n)||e.isString(n))&&(n={fn:n}),e.isArray(n)||(n=[n]),e.reduce(n,function(t,i){return e.each(e.without(e.keys(i),"msg","msgKey"),function(e){t.push({fn:h[e],val:i[e],msg:i.msg,msgKey:i.msgKey})}),t},[])},c=function(e){var t,i,n=0,s=!0,r=[];for(t=e.indexOf("[",n);t>0&&s;)i=e.indexOf("]",n),r.push(parseInt(e.substring(t+1,i),10)),n=i+1,s=n>0,t=e.indexOf("[",n);return r},u=function(t,i,n){var s,r,o,a,d,c=t.indexOf("[]");if(e.isEmpty(n)&&(n=[]),-1===c)return{attr:t,index:n};for(r=t.substring(0,c),o=t.substring(c+2),a=[],s=0;s<i.get(r).length;s++)d=n.slice(),d.push(s),a.push(u(r+"["+s+"]"+o,i,d));return a},f=function(e){return t&&e instanceof t},p=function(e){return e.indexOf(".")>0||e.indexOf("]")>0},m=function(e){var t,i,n=0,s=!0;if(t=e.indexOf("[",n),0>t)return e;for(i=e.substring(0,t+1);t>0&&s;)n=e.indexOf("]",n)+1,s=n>0,t=e.indexOf("[",n),t>0&&(i+=e.substring(n-1,t+1));return i+=e.substring(n-1)},_=function(t,i,n,s,r,o){var a,d;return e.isArray(i)?e.reduce(i,function(e,i){return e.push(_(t,i,n,s,r,o+1)),e},[]):(d=i.index,a=i.attr,e.isUndefined(n)&&p(a)&&(n=t.get(a)),g(r,t,n,a,s,d))},g=function(t,i,s,r,o,a){return e.reduce(t,function(t,d){var c=e.extend({msgKey:d.msgKey},n,h),u=d.fn.call(c,s,r,d.val,i,o,a);return u===!1||t===!1?!1:u&&!t?e.result(e.extend({},d,n,h),"msg")||u:t},"")},v=function(t,i,n,s){var r,o,a,c=d(t,i);return o=u(i,t),a=_(t,o,n,s,c,0),e.isArray(a)&&(r=e.reduce(e.flatten(a),function(e,t){return e||t},!1),!r)?"":a},F=function(t,i,n){var s,r={},o=!0,a=e.clone(i);return e.each(n,function(e,i){s=v(t,i,e,a),s&&(r[i]=s,o=!1)}),{invalidAttrs:r,isValid:o}},b=function(t,i,n){var s,r,o=t.validation?e.result(t,"validation")||{}:{};return e.contains(e.keys(o),n)?v(t,n,i,e.extend({},t.attributes)):(s=c(n),n=m(n),r=d(t,n),g(r,t,i,n,e.extend({},t.attributes),s))},T=function(t,i){return{preValidate:function(t,i){var n,s=this,r={};return e.isArray(t)?(e.each(t,function(e){n=s.preValidate(e),n&&(r[e]=n)}),e.isEmpty(r)?void 0:r):e.isObject(t)?(e.each(t,function(e,t){n=s.preValidate(t,e),n&&(r[t]=n)}),e.isEmpty(r)?void 0:r):(e.isUndefined(i)&&f(this)&&(i=this.get(t)),b(this,i,t))},isValid:function(n){var r,o,d;return n=n||a(i,t),e.isString(n)?r=[n]:e.isArray(n)&&(r=n),r&&e.each(r,function(t){var n;n=f(this)?this.get(t):s(this.attributes)[t],o=b(this,n,t),o&&(d=d||{},d[t]=o),e.each(this.associatedViews,function(e){o?i.invalid(e,t,o,i.selector):i.valid(e,t,i.selector)},this)},this),n===!0&&(d=this.validate()),d&&this.trigger("invalid",this,d,{validationError:d}),r?!d:this.validation?this._isValid:!0},validate:function(n,o){var d,c,u,l,h,f,p,m=this;return d=!n,c=e.extend({},i,o),u=r(m,a(i,t)),l=e.extend({},u,m.attributes,n),h=s(l),f=n?s(n):h,p=F(m,l,e.pick(h,e.keys(u))),m._isValid=p.isValid,e.each(m.associatedViews,function(t){e.each(u,function(e,i){var n=p.invalidAttrs.hasOwnProperty(i),s=f.hasOwnProperty(i);n||c.valid(t,i,c.selector),n&&(s||d)&&c.invalid(t,i,p.invalidAttrs[i],c.selector)})}),e.defer(function(){m.trigger("validated",m._isValid,m,p.invalidAttrs),m.trigger("validated:"+(m._isValid?"valid":"invalid"),m,p.invalidAttrs)}),!c.forceUpdate&&e.intersection(e.keys(p.invalidAttrs),e.keys(f)).length>0?p.invalidAttrs:void 0}}},w=function(t,i,n){i.associatedViews?i.associatedViews.push(t):i.associatedViews=[t],e.extend(i,T(t,n))},y=function(t,i){i&&t.associatedViews.length>1?t.associatedViews=e.without(t.associatedViews,i):(delete t.validate,delete t.preValidate,delete t.isValid,delete t.associatedViews)},k=function(e){w(this.view,e,this.options)},x=function(e){y(e)};return{version:"0.11.3",configure:function(t){e.extend(i,t)},bind:function(t,n){n=e.extend({},i,o,n);var s=n.model||t.model,r=n.collection||t.collection;if("undefined"==typeof s&&"undefined"==typeof r)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";s?w(t,s,n):r&&(r.each(function(e){w(t,e,n)}),r.bind("add",k,{view:t,options:n}),r.bind("remove",x))},unbind:function(t,i){i=e.extend({},i);var n=i.model||t.model,s=i.collection||t.collection;n?y(n,t):s&&(s.each(function(e){y(e,t)}),s.unbind("add",k),s.unbind("remove",x))},mixin:T(null,i)}}(),o=r.callbacks={valid:function(e,t,i){e.$("["+i+'~="'+t+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(e,t,i,n){e.$("["+n+'~="'+t+'"]').addClass("invalid").attr("data-error",i)}},a=r.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i
},d=r.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},c=r.labelFormatters={none:function(e){return e},sentenceCase:function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toUpperCase():" "+e.toLowerCase()}).replace(/_/g," ")},label:function(e,t){return t.labels&&t.labels[e]||c.sentenceCase(e,t)}},u=r.messageFormatters={none:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return t.replace(/\{(\d+)\}/g,function(t,i){return"undefined"!=typeof e[i]?e[i]:t})}},l=r.attributeLoaders={inputNames:function(e){var t=[];return e&&e.$("form [name]").each(function(){/^(?:input|select|textarea)$/i.test(this.nodeName)&&this.name&&"submit"!==this.type&&-1===t.indexOf(this.name)&&t.push(this.name)}),t}},h=r.validators=function(){var t=String.prototype.trim?function(e){return null===e?"":String.prototype.trim.call(e)}:function(e){var t=/^\s+/,i=/\s+$/;return null===e?"":e.toString().replace(t,"").replace(i,"")},i=function(t){return e.isNumber(t)||e.isString(t)&&t.match(a.number)},s=function(i){return!(e.isNull(i)||e.isUndefined(i)||e.isString(i)&&""===t(i)||e.isArray(i)&&e.isEmpty(i))},r=function(e,t){return e?e:t};return{format:n.format,formatLabel:n.formatLabel,fn:function(t,i,n,s,r){return e.isString(n)&&(n=s[n]),n.call(s,t,i,r)},inlineFn:function(e,t,i,n,s,r){return i.call(this,e,t,n,s,r)},required:function(t,i,n,o,a){var c=e.isFunction(n)?n.call(o,t,i,a):n;return c||s(t)?c&&!s(t)?this.format(r(this.msgKey,d.required),this.formatLabel(i,o)):void 0:!1},acceptance:function(t,i,n,s){return"true"===t||e.isBoolean(t)&&t!==!1?void 0:this.format(r(this.msgKey,d.acceptance),this.formatLabel(i,s))},min:function(e,t,n,s){return!i(e)||n>e?this.format(r(this.msgKey,d.min),this.formatLabel(t,s),n):void 0},max:function(e,t,n,s){return!i(e)||e>n?this.format(r(this.msgKey,d.max),this.formatLabel(t,s),n):void 0},range:function(e,t,n,s){return!i(e)||e<n[0]||e>n[1]?this.format(r(this.msgKey,d.range),this.formatLabel(t,s),n[0],n[1]):void 0},length:function(t,i,n,s){return e.isString(t)&&t.length===n?void 0:this.format(r(this.msgKey,d.length),this.formatLabel(i,s),n)},minLength:function(t,i,n,s){return!e.isString(t)||t.length<n?this.format(r(this.msgKey,d.minLength),this.formatLabel(i,s),n):void 0},maxLength:function(t,i,n,s){return!e.isString(t)||t.length>n?this.format(r(this.msgKey,d.maxLength),this.formatLabel(i,s),n):void 0},rangeLength:function(t,i,n,s){return!e.isString(t)||t.length<n[0]||t.length>n[1]?this.format(r(this.msgKey,d.rangeLength),this.formatLabel(i,s),n[0],n[1]):void 0},oneOf:function(t,i,n,s){return e.include(n,t)?void 0:this.format(r(this.msgKey,d.oneOf),this.formatLabel(i,s),n.join(", "))},equalTo:function(e,t,i,n,s){return e!==s[i]?this.format(r(this.msgKey,d.equalTo),this.formatLabel(t,n),this.formatLabel(i,n)):void 0},pattern:function(e,t,i,n){return s(e)&&e.toString().match(a[i]||i)?void 0:this.format(r(this.msgKey,d[i])||d.inlinePattern,this.formatLabel(t,n),i)}}}();return r}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","jquery","./NestedModel","./validation"],t):"object"==typeof exports?module.exports=t(require("underscore"),require("jquery"),require("./NestedModel"),require("./validation")):(e.Torso=e.Torso||{},e.Torso.FormModel=t(e._,e.jQuery||e.Zepto||e.ender||e.$,e.Torso.NestedModel,e.Torso.validation))}(this,function(e,t,i,n){"use strict";var s=i.extend({defaultMapping:null,constructor:function(t,n){i.apply(this,arguments),n=n||{},this.__computed=[],this.__cache={},this.__currentUpdateEvents=[],this.__modelConfigs=[],this.__initMappings(n),this.validation=e.extend({},this.validation||{},n.validation||{}),this.labels=e.extend({},this.labels||{},n.labels||{}),this.pull(),t&&this.set(t),n.startUpdating&&this.startUpdating(),this.trigger("initialization-complete")},addModel:function(e,t){this.__modelConfigs.push(e),t&&(this.__copyFields(e.fields,this,e.model),this.__updateCache(e.model))},addComputed:function(t,i){this.__computed.push(t),i&&(this.__invokeComputedPull.call({formModel:this,models:t.models,pull:t.pull}),e.each(t.models,function(e){this.__updateCache(e.model)},this))},isTrackingObjectModel:function(){return e.size(this.__modelConfigs)>0||e.size(this.__computed)>0},isUpdating:function(){return this.__currentUpdateEvents.length>0},startUpdating:function(e){this.isTrackingObjectModel()&&!this.isUpdating()&&(e&&this.pull(),this.__setupListeners())},stopUpdating:function(){e.each(this.__currentUpdateEvents,function(e){this.stopListening(e.model,e.eventName)},this),this.__currentUpdateEvents=[]},save:function(n){var s,r,o=new t.Deferred,a=this;n=n||{},e.defaults(n,{rollback:!0,force:!0});try{r=e.result(a,"url")}catch(d){}return r?i.prototype.save.apply(a,arguments).done(function(){a.push()}):this.isTrackingObjectModel()?(this.__saveToModels(o,n),o.promise()):(s={none:{success:!1,response:[{responseJSON:{generalReasons:[{messageKey:"no.models.were.bound.to.form"}]}}]}},this.trigger("save-fail",s),(new t.Deferred).reject(s).promise())},push:function(){e.each(this.__modelConfigs,function(e){this.__copyFields(e.fields,e.model,this)},this),e.each(this.__computed,function(t){t.push&&t.push.apply(this,[e.pluck(t.models,"model")])},this)},pull:function(){e.each(this.__modelConfigs,function(e){this.__copyFields(e.fields,this,e.model),this.__updateCache(e.model)},this),e.each(this.__computed,function(t){this.__invokeComputedPull.call({formModel:this,models:t.models,pull:t.pull}),e.each(t.models,function(e){this.__updateCache(e.model)},this)},this)},isModelStale:function(e,t,i){var n;i=i||{},i[e.cid]||(i[e.cid]=this.__generateHashValue(e)),n=i[e.cid];var s=this.__cache[e.cid]!==n;return t&&(s?t[e.cid]=e:t[e.cid]&&delete t[e.cid]),s},checkIfModelsAreStale:function(){var t={},i=this.__generateAllHashValues();return e.each(this.__getAllModels(!0),function(e){this.isModelStale(e,t,i)},this),e.values(t)},listenToModelField:function(t,i){var n="change:"+i;this.listenTo(t,n,e.bind(this.__updateFormField,{formModel:this,field:i})),this.__currentUpdateEvents.push({model:t,eventName:n})},listenToComputedValuesDependency:function(t,i,n){var s="change:"+n;this.listenTo(i,"change:"+n,e.bind(this.__invokeComputedPull,{formModel:this,models:t.models,pull:t.pull})),this.__currentUpdateEvents.push({model:i,eventName:s})},__saveToModels:function(t,i){function n(n,s,u){d[s.cid]={success:u,response:n},a+o===l&&(a>0?(i.rollback&&e.each(r.__getAllModels(!0),function(e){e.set(c[e.cid]),d[e.cid].success&&e.save()}),r.trigger("save-fail",d),t.reject(d)):(r.trigger("save-success",d),t.resolve(d)))}var s,r=this,o=0,a=0,d={},c={},u=r.__getAllModels(!0),l=u.length;if(!i.force&&(s=r.checkIfModelsAreStale(),s.length>0))throw{name:"Stale data",staleModels:s};e.each(u,function(e){c[e.cid]=r.__getTrackedModelFields(e)}),r.push(),e.each(u,function(e){e.save().fail(function(){a++,n(arguments,e,!1)}).done(function(){o++,n(arguments,e,!0)})})},__updateFormField:function(e,t){this.formModel.set(this.field,t),this.formModel.__updateCache(e)},__updateFormModel:function(t){e.each(t.changedAttributes(),function(e,t){this.set(t,this.__cloneVal(e))},this),this.__updateCache(t)},__updateCache:function(e){this.__cache[e.cid]=this.__generateHashValue(e)},__hashValue:function(e){return JSON.stringify(e)},__generateHashValue:function(e){var t=this.__getTrackedModelFields(e);return this.__hashValue(t)},__generateAllHashValues:function(){var t={};return e.each(this.__getAllModels(!0),function(e){t[e.cid]=this.__generateHashValue(e)},this),t},__cloneVal:function(i){var n;if(e.isArray(i))n=[];else{if(!e.isObject(i))return i;n={}}return t.extend(!0,n,i)},__setupListeners:function(){e.each(this.__modelConfigs,function(t){t.fields?e.each(t.fields,function(e){this.listenToModelField(t.model,e)},this):(this.listenTo(t.model,"change",this.__updateFormModel,this),this.__currentUpdateEvents.push({model:t.model,eventName:"change"}))},this),e.each(this.__computed,function(t){e.each(t.models,function(i){e.each(i.fields,function(e){this.listenToComputedValuesDependency(t,i.model,e)},this)},this)},this)},__copyFields:function(t,i,n){t||this!==n||(t=e.keys(i.attributes)),t?e.each(t,function(e){i.set(e,this.__cloneVal(n.get(e)))},this):i.set(this.__cloneVal(n.attributes))},__initMappings:function(t){var i=e.result(this,"mapping"),n=e.pick(t,["model","fields","models","computed"]);this.__initModels(n,i),this.__initComputeds(n,i)},__initModels:function(t,i){var n=this.__pullModelsFromMapping(t)||this.__pullModelsFromMapping(i);e.each(n,this.addModel,this)},__initComputeds:function(t,i){var n;t=t||{},i=i||{},n=t.computed||i.computed,e.each(n,this.addComputed,this)},__pullModelsFromMapping:function(e){var t=[];return e&&e.model?t.push({model:e.model,fields:e.fields}):e&&e.models&&(t=e.models.slice()),0===t.length?null:t},__getTrackedModelFields:function(t){var i,n={},s={},r=[];return e.each(this.__getAllModelConfigs(),function(e){e.model.cid===t.cid&&r.push(e)}),i=e.reduce(r,function(e,t){return e||!t.fields},!1),i?s=this.__cloneVal(t.attributes):e.each(r,function(i){e.each(i.fields,function(e){n[e]||(n[e]=!0,s[e]=this.__cloneVal(t.get(e)))},this)},this),s},__getAllModels:function(t){var i={},n=e.pluck(this.__getAllModelConfigs(),"model");if(t){var s=[];e.each(n,function(e){i[e.cid]||(i[e.cid]=!0,s.push(e))}),n=s}return n},__getAllModelConfigs:function(){var t=this.__modelConfigs.slice();return e.each(this.__computed,function(e){t=t.concat(e.models)}),t},__invokeComputedPull:function(t){var i=[];t&&this.formModel.__updateCache(t),function(t,n,s){e.each(s,function(n){n.fields?e.each(n.fields,function(e){i.push(t.__cloneVal(n.model.get(e)))}):i.push(t.__cloneVal(n.model.attributes))}),n.apply(t,i)}(this.formModel,this.pull,this.models)}});return e.extend(s.prototype,n.mixin),s}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","jquery","./View","./templateRenderer"],t):"object"==typeof exports?module.exports=t(require("underscore"),require("jquery"),require("./View"),require("./templateRenderer")):(e.Torso=e.Torso||{},e.Torso.ListView=t(e._,e.$,e.Torso.View,e.Torso.Utils.templateRenderer))}(this,function(e,t,i,n){"use strict";var s,r,o,a,d,c;c=function(e){e.__delayedRenderTimeout&&(clearTimeout(e.__delayedRenderTimeout),e.__delayedRenderTimeout=null,e.render())},d=function(e,t){var i=function(){t.__delayedRenderTimeout=null,t.render()};return function(){!t.__delayedRenderTimeout&&e>0?t.__delayedRenderTimeout=setTimeout(i,e):0>=e&&t.render()}},s=function(e){var t=this.getItemViewFromModel(e);t&&(r.call(this,t,e[this.__modelId],e),this.hasItemViews()||this.__delayedRender())},r=function(e,t,i){e.dispose(),this.unregisterTrackedView(e,{shared:!1}),delete this.__modelToViewMap[t],this.__updateOrderedModelIdList(),this.trigger("item-view-removed",{model:i||e.model,view:e}),this.trigger("child-view-removed",{model:i||e.model,view:e})},o=function(e){var t,i=this.modelsToRender(),n=i.indexOf(e);n>-1&&(t=this.__createItemView(e),a.call(this,t,n))},a=function(t,i){var n,s,r,o=this.modelsToRender();this.hasItemViews()?(c(this),n=this.getItemViewFromModel(o[i+1]),s=this.getItemViewFromModel(o[i-1]),n?r=e.bind(n.$el.before,n.$el):s?r=e.bind(s.$el.after,s.$el):this.__delayedRender(),r&&this.attachView(null,t,{replaceMethod:r,discardInjectionSite:!0})):this.__delayedRender()};var u=i.extend({collection:null,itemView:null,template:null,emptyTemplate:null,itemContainer:null,__modelName:"",__modelId:"",__modelToViewMap:null,__itemContext:null,__renderWait:0,__delayedRender:null,__delayedRenderTimeout:null,constructor:function(e){i.apply(this,arguments),e=e||{};var t=e.collection||this.collection;if(this.template=e.template||this.template,this.emptyTemplate=e.emptyTemplate||this.emptyTemplate,this.itemView=e.itemView||this.itemView||e.childView||this.childView,this.itemContainer=e.itemContainer||this.itemContainer||e.childrenContainer||this.childrenContainer,this.template&&!this.itemContainer)throw"Item container is required when using a template";this.modelsToRender=e.modelsToRender||this.modelsToRender,this.__itemContext=e.itemContext||this.__itemContext||e.childContext||this.__childContext,this.__modelToViewMap={},this.__renderWait=e.renderWait||this.__renderWait,this.__modelId=e.modelId||"cid",this.__modelName=e.modelName||e.childModel||"model",this.__orderedModelIdList=[],this.__createItemViews(),this.__delayedRender=d(this.__renderWait,this),t&&this.setCollection(t)},setCollection:function(e){this.stopListening(this.collection,"remove",s),this.stopListening(this.collection,"add",o),this.stopListening(this.collection,"sort",this.reorder),this.stopListening(this.collection,"reset",this.update),this.collection=e,this.listenTo(this.collection,"remove",s),this.listenTo(this.collection,"add",o),this.listenTo(this.collection,"sort",this.reorder),this.listenTo(this.collection,"reset",this.update)},render:function(){var i,s=t(n.copyTopElement(this.el));this.trigger("render-begin"),this.prerender(),this.__updateInjectionSiteMap(),this.template?(s.html(this.template(this.prepare())),i=s.find("[inject="+this.itemContainer+"]")):(i=t("<span>"),s.append(i)),this.hasItemViews()?i.replaceWith(this.__emptyAndRebuildItemViewsFragment()):this.emptyTemplate&&i.replaceWith(this.emptyTemplate(this.prepareEmpty())),this.trigger("render-before-dom-replacement",s),this.$el.html(s.contents()),this.delegateEvents(),this.trigger("render-after-dom-replacement"),e.each(this.modelsToRender(),function(e){var t=this.getItemViewFromModel(e);t&&(t.__cleanupAfterReplacingInjectionSite(),t.activate())},this),this.attachTrackedViews(),this.__injectionSiteMap={},this.postrender(),this.trigger("render-complete")},renderChildViews:function(){e.each(this.getTrackedViews({child:!0}),function(e){e.render()})},reorder:function(){var i,n,s=[],r=this.modelsToRender(),o=e.pluck(r,this.__modelId),a=e.size(o),d=e.size(this.__orderedModelIdList),c=a===d;if(!c)throw"Reorder should not be invoked if the number of models have changed";if(n=e.reduce(this.__orderedModelIdList,function(e,t,i){return e&&o[i]==t},!0),a&&!n){if(e.each(r,function(e,t){var n=this.getItemViewFromModel(e);n&&s.push(n.$el),0===t&&(i=n)},this),this.itemContainer){if(i){var u=t("<span>");i.$el.before(u),u.after(s),u.remove()}}else this.$el.append(s);this.__updateOrderedModelIdList(o),this.trigger("reorder-complete")}},prepare:function(){return{}},prepareEmpty:function(){return{}},modelsToRender:function(){return this.collection?this.collection.models:[]},update:function(){var t=!1,i=this.getItemViews(),n=this.__createItemViews(),s=this.__getStaleItemViews(),r=e.size(i),o=e.size(n),a=e.size(s),d=r-a+o,c=o+a,u=c/Math.max(d,1),l=!r&&o,h=r&&r===a&&!o,f=this.updateThreshold||.5,p=u>=f;return 0>=c?this.reorder():(t=l||h||p,void(t?(this.__removeStaleItemViews(s),this.__delayedRender()):this.__updateByAddingRemoving(i,n,s)))},getItemViewFromModel:function(e){return e?this.getTrackedView(this.__modelToViewMap[e[this.__modelId]]):void 0},getChildViewFromModel:function(){return this.getItemViewFromModel.apply(this,arguments)},hasItemViews:function(){return!e.isEmpty(this.getItemViews())},getItemViews:function(){var t=e.map(this.__orderedModelIdList,this.__getViewIdFromModelId,this);return e.map(t,this.getTrackedView,this)},__createItemViews:function(){var t=[];return e.each(this.modelsToRender(),function(e,i){var n=this.getItemViewFromModel(e);n||t.push({view:this.__createItemView(e,!0),indexOfModel:i})},this),this.__updateOrderedModelIdList(),t},__createItemView:function(t,i){var n,s=this.itemView;return e.isFunction(this.itemView.extend)||(s=this.itemView(t)),n=new s(this.__generateItemViewArgs(t)),this.registerTrackedView(n,{shared:!1}),this.__modelToViewMap[t[this.__modelId]]=n.cid,i||this.__updateOrderedModelIdList(),this.trigger("child-view-added",{model:t,view:n}),this.trigger("item-view-added",{model:t,view:n}),n},__getStaleItemViews:function(){var t=[],i=e.clone(this.__modelToViewMap);return e.each(this.modelsToRender(),function(e){var t=this.getItemViewFromModel(e);t&&delete i[e[this.__modelId]]},this),e.each(i,function(e,i){var n=this.getTrackedView(e);n&&t.push({view:n,modelId:i})},this),t},__removeStaleItemViews:function(t){var i=this;t=t||this.__getStaleItemViews(),e.each(t,function(e){r.call(i,e.view,e.modelId)})},__emptyAndRebuildItemViewsFragment:function(){var i=document.createDocumentFragment();return this.$el.empty(),e.each(this.modelsToRender(),function(e){var t=this.getItemViewFromModel(e);t&&(t.detach(),this.registerTrackedView(t),t.render(),i.appendChild(t.el))},this),this.__updateOrderedModelIdList(),t(i)},__updateByAddingRemoving:function(i,n,s){var r,o,d=this,c=e.size(i),u=(e.size(n),e.size(s));d.itemContainer&&c&&c==u&&(o=t("<span>"),e.first(i).$el.before(o)),d.__removeStaleItemViews(s),e.each(n,function(t,i){if(0===t.indexOfModel){var n;if(d.itemContainer)if(o)n=e.bind(o.replaceWith,o);else{var c=e.indexBy(s,"modelId"),u=e.find(d.__orderedModelIdList,function(e){return!c[e]});r=d.getTrackedView(d.__modelToViewMap[u]),n=e.bind(r.$el.prepend,r.$el)}else n=e.bind(d.$el.prepend,d.$el);d.attachView(null,t.view,{replaceMethod:n,discardInjectionSite:!0})}else a.call(d,t.view,t.indexOfModel)}),this.reorder()},__updateOrderedModelIdList:function(t){this.__orderedModelIdList=t||e.pluck(this.modelsToRender(),this.__modelId)},__generateItemViewArgs:function(t){var i={context:e.extend({},e.result(this,"__itemContext")),listView:this};return i[this.__modelName]=t,i},__generateChildArgs:function(){return this.__generateItemViewArgs.apply(this,arguments)},__getViewIdFromModelId:function(e){return this.__modelToViewMap[e]}});return u}),function(e,t){"function"==typeof define&&define.amd?define(["underscore","jquery","./View","./FormModel","./Cell","backbone.stickit"],t):"object"==typeof exports?(require("backbone.stickit"),module.exports=t(require("underscore"),require("jquery"),require("./View"),require("./FormModel"),require("./Cell"))):(e.Torso=e.Torso||{},e.Torso.FormView=t(e._,e.jQuery||e.Zepto||e.ender||e.$,e.Torso.View,e.Torso.FormModel,e.Torso.Cell))}(this,function(e,t,i,n,s){"use strict";var r=i.extend({constructor:function(t){t=t||{},this.model=this.model||new n,this.listenTo(this.model,"validated:valid",this.valid),this.listenTo(this.model,"validated:invalid",this.invalid),this.template=t.template||this.template,this.events=e.extend({},this.events||{},t.events||{}),this.fields=e.extend({},this.fields||{},t.fields||{}),this._errors=[],this._success=!1,this._bindings=e.extend({},this.bindings||{},t.bindings||{}),i.apply(this,arguments)},prepare:function(){return{model:this.model.toJSON(),view:this.viewState.toJSON(),formErrors:0!==e.size(this._errors)?this._errors:null,formSuccess:this._success}},delegateEvents:function(){this.__generateStickitBindings(),this.stickit(),i.prototype.delegateEvents.call(this)},valid:function(){this._success=!0,this._errors=[]},invalid:function(e,t){this._success=!1,this._errors=t},_deactivate:function(){i.prototype._deactivate.call(this),this.unstickit()},_thenAddClassIfInvalid:function(e,t,i){var n=this.model.isValid(e);return(i?!0:!1)==(n?!0:!1)?{addClass:t}:{removeClass:t}},_thenSetTextIfInvalid:function(e,t,i){var n=this.model.isValid(e);return(i?!0:!1)==(n?!0:!1)?{text:t}:{text:""}},__generateStickitBindings:function(){var i=this;this.bindings=e.extend({},this._bindings),e.each(this.$("[data-model]"),function(e){var n=t(e).data("model"),s=i.__getFieldOptions(n),r=i.__generateModelFieldBinding(n,s);i.bindings['[data-model="'+n+'"]']=r})},__getFieldOptions:function(e){return e=this.__stripAllAttribute(e),this.fields[e]||{}},__generateModelFieldBinding:function(t,i){var n=this.__getAllIndexTokens(t);return{observe:t,onSet:function(t){var s=[t];return s.push(n),s=e.flatten(s),i.modelFormat?i.modelFormat.apply(this,s):t},onGet:function(t){var s=[t];return s.push(n),s=e.flatten(s),i.viewFormat?i.viewFormat.apply(this,s):t}}}});return r});